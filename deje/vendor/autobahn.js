/*
 AutobahnJS - http://autobahn.ws

 Copyright (C) 2011-2014 Tavendo GmbH.
 Licensed under the MIT License.
 See license text at http://www.opensource.org/licenses/mit-license.php

 AutobahnJS includes code from:

 when - http://cujojs.com

 (c) copyright B Cavalier & J Hann
 Licensed under the MIT License at:
 http://www.opensource.org/licenses/mit-license.php

 Crypto-JS - http://code.google.com/p/crypto-js/

 (c) 2009-2012 by Jeff Mott. All rights reserved.
 Licensed under the New BSD License at:
 http://code.google.com/p/crypto-js/wiki/License

 console-normalizer - https://github.com/Zenovations/console-normalizer

 (c) 2012 by Zenovations.
 Licensed under the MIT License at:
 http://www.opensource.org/licenses/mit-license.php

*/
window.define||(window.define=function(g){try{delete window.define}catch(h){window.define=void 0}window.when=g()},window.define.amd={});(function(g){g||(g=window.console={log:function(g,a,b,c,f){},info:function(g,a,b,c,f){},warn:function(g,a,b,c,f){},error:function(g,a,b,c,f){}});Function.prototype.bind||(Function.prototype.bind=function(g){var a=this,b=Array.prototype.slice.call(arguments,1);return function(){return a.apply(g,Array.prototype.concat.apply(b,arguments))}});"object"===typeof g.log&&(g.log=Function.prototype.call.bind(g.log,g),g.info=Function.prototype.call.bind(g.info,g),g.warn=Function.prototype.call.bind(g.warn,g),
g.error=Function.prototype.call.bind(g.error,g));"group"in g||(g.group=function(h){g.info("\n--- "+h+" ---\n")});"groupEnd"in g||(g.groupEnd=function(){g.log("\n")});"time"in g||function(){var h={};g.time=function(a){h[a]=(new Date).getTime()};g.timeEnd=function(a){var b=(new Date).getTime();g.info(a+": "+(a in h?b-h[a]:0)+"ms")}}()})(window.console);/*
 MIT License (c) copyright 2011-2013 original author or authors */
(function(g){g("when",function(g){function a(a,b,d,e){return(a instanceof c?a:f(a)).then(b,d,e)}function b(a){return new c(a,B.PromiseStatus&&B.PromiseStatus())}function c(a,b){function c(a){if(l){var f=l;l=y;p(function(){q=d(g,a);b&&u(q,b);e(f,q)})}}function f(a){c(new k(a))}function m(a){if(l){var b=l;p(function(){e(b,new w(a))})}}var g,q,l=[];g=this;this._status=b;this.inspect=function(){return q?q.inspect():{state:"pending"}};this._when=function(a,b,d,c,e){function f(u){u._when(a,b,d,c,e)}l?l.push(f):
p(function(){f(q)})};try{a(c,f,m)}catch(n){f(n)}}function f(a){return b(function(b){b(a)})}function e(a,b){for(var d=0;d<a.length;d++)a[d](b)}function d(a,b){if(b===a)return new k(new TypeError);if(b instanceof c)return b;try{var d=b===Object(b)&&b.then;return"function"===typeof d?m(d,b):new x(b)}catch(e){return new k(e)}}function m(a,d){return b(function(b,c){G(a,d,b,c)})}function x(a){this.value=a}function k(a){this.value=a}function w(a){this.value=a}function u(a,b){a.then(function(){b.fulfilled()},
function(a){b.rejected(a)})}function q(a){return a&&"function"===typeof a.then}function l(d,c,e,f,u){return a(d,function(d){return b(function(b,e,f){function u(a){n(a)}function g(a){k(a)}var m,q,D,l,k,n,x,w;x=d.length>>>0;m=Math.max(0,Math.min(c,x));D=[];q=x-m+1;l=[];if(m)for(n=function(a){l.push(a);--q||(k=n=s,e(l))},k=function(a){D.push(a);--m||(k=n=s,b(D))},w=0;w<x;++w)w in d&&a(d[w],g,u,f);else b(D)}).then(e,f,u)})}function n(a,b,d,c){return t(a,s).then(b,d,c)}function t(b,d,e){return a(b,function(b){return new c(function(c,
f,u){function m(b,q){a(b,d,e).then(function(a){g[q]=a;--k||c(g)},f,u)}var g,q,k,l;k=q=b.length>>>0;g=[];if(k)for(l=0;l<q;l++)l in b?m(b[l],l):--k;else c(g)})})}function A(a){return{state:"fulfilled",value:a}}function z(a){return{state:"rejected",reason:a}}function p(a){1===E.push(a)&&C(v)}function v(){e(E);E=[]}function s(a){return a}function K(a){"function"===typeof B.reportUnhandled?B.reportUnhandled():p(function(){throw a;});throw a;}a.promise=b;a.resolve=f;a.reject=function(b){return a(b,function(a){return new k(a)})};
a.defer=function(){var a,d,c;a={promise:y,resolve:y,reject:y,notify:y,resolver:{resolve:y,reject:y,notify:y}};a.promise=d=b(function(b,e,u){a.resolve=a.resolver.resolve=function(a){if(c)return f(a);c=!0;b(a);return d};a.reject=a.resolver.reject=function(a){if(c)return f(new k(a));c=!0;e(a);return d};a.notify=a.resolver.notify=function(a){u(a);return a}});return a};a.join=function(){return t(arguments,s)};a.all=n;a.map=function(a,b){return t(a,b)};a.reduce=function(b,d){var c=G(H,arguments,1);return a(b,
function(b){var e;e=b.length;c[0]=function(b,c,f){return a(b,function(b){return a(c,function(a){return d(b,a,f,e)})})};return I.apply(b,c)})};a.settle=function(a){return t(a,A,z)};a.any=function(a,b,d,c){return l(a,1,function(a){return b?b(a[0]):a[0]},d,c)};a.some=l;a.isPromise=q;a.isPromiseLike=q;r=c.prototype;r.then=function(a,b,d){var e=this;return new c(function(c,f,u){e._when(c,u,a,b,d)},this._status&&this._status.observed())};r["catch"]=r.otherwise=function(a){return this.then(y,a)};r["finally"]=
r.ensure=function(a){function b(){return f(a())}return"function"===typeof a?this.then(b,b).yield(this):this};r.done=function(a,b){this.then(a,b)["catch"](K)};r.yield=function(a){return this.then(function(){return a})};r.tap=function(a){return this.then(a).yield(this)};r.spread=function(a){return this.then(function(b){return n(b,function(b){return a.apply(y,b)})})};r.always=function(a,b){return this.then(a,a,b)};F=Object.create||function(a){function b(){}b.prototype=a;return new b};x.prototype=F(r);
x.prototype.inspect=function(){return A(this.value)};x.prototype._when=function(a,b,d){try{a("function"===typeof d?d(this.value):this.value)}catch(c){a(new k(c))}};k.prototype=F(r);k.prototype.inspect=function(){return z(this.value)};k.prototype._when=function(a,b,d,c){try{a("function"===typeof c?c(this.value):this)}catch(e){a(new k(e))}};w.prototype=F(r);w.prototype._when=function(a,b,d,c,e){try{b("function"===typeof e?e(this.value):this.value)}catch(f){b(f)}};var r,F,I,H,G,C,E,B,J,y;E=[];B="undefined"!==
typeof console?console:a;if("object"===typeof process&&process.nextTick)C=process.nextTick;else if(r="function"===typeof MutationObserver&&MutationObserver||"function"===typeof WebKitMutationObserver&&WebKitMutationObserver)C=function(a,b,d){var c=a.createElement("div");(new b(d)).observe(c,{attributes:!0});return function(){c.setAttribute("x","x")}}(document,r,v);else try{C=g("vertx").runOnLoop||g("vertx").runOnContext}catch(L){J=setTimeout,C=function(a){J(a,0)}}g=Function.prototype;r=g.call;G=g.bind?
r.bind(r):function(a,b){return a.apply(b,H.call(arguments,2))};g=[];H=g.slice;I=g.reduce||function(a){var b,d,c,e;e=0;b=Object(this);c=b.length>>>0;d=arguments;if(1>=d.length)for(;;){if(e in b){d=b[e++];break}if(++e>=c)throw new TypeError;}else d=d[1];for(;e<c;++e)e in b&&(d=a(d,b[e],e,b));return d};return a})})("function"===typeof define&&define.amd?define:function(g){module.exports=g(require)});var CryptoJS=CryptoJS||function(g,h){var a={},b=a.lib={},c=b.Base=function(){function a(){}return{extend:function(b){a.prototype=this;var d=new a;b&&d.mixIn(b);d.hasOwnProperty("init")||(d.init=function(){d.$super.init.apply(this,arguments)});d.init.prototype=d;d.$super=this;return d},create:function(){var a=this.extend();a.init.apply(a,arguments);return a},init:function(){},mixIn:function(a){for(var b in a)a.hasOwnProperty(b)&&(this[b]=a[b]);a.hasOwnProperty("toString")&&(this.toString=a.toString)},
clone:function(){return this.init.prototype.extend(this)}}}(),f=b.WordArray=c.extend({init:function(a,b){a=this.words=a||[];this.sigBytes=b!=h?b:4*a.length},toString:function(a){return(a||d).stringify(this)},concat:function(a){var b=this.words,d=a.words,c=this.sigBytes;a=a.sigBytes;this.clamp();if(c%4)for(var e=0;e<a;e++)b[c+e>>>2]|=(d[e>>>2]>>>24-e%4*8&255)<<24-(c+e)%4*8;else if(65535<d.length)for(e=0;e<a;e+=4)b[c+e>>>2]=d[e>>>2];else b.push.apply(b,d);this.sigBytes+=a;return this},clamp:function(){var a=
this.words,b=this.sigBytes;a[b>>>2]&=4294967295<<32-b%4*8;a.length=g.ceil(b/4)},clone:function(){var a=c.clone.call(this);a.words=this.words.slice(0);return a},random:function(a){for(var b=[],d=0;d<a;d+=4)b.push(4294967296*g.random()|0);return new f.init(b,a)}}),e=a.enc={},d=e.Hex={stringify:function(a){var b=a.words;a=a.sigBytes;for(var d=[],c=0;c<a;c++){var e=b[c>>>2]>>>24-c%4*8&255;d.push((e>>>4).toString(16));d.push((e&15).toString(16))}return d.join("")},parse:function(a){for(var b=a.length,
d=[],c=0;c<b;c+=2)d[c>>>3]|=parseInt(a.substr(c,2),16)<<24-c%8*4;return new f.init(d,b/2)}},m=e.Latin1={stringify:function(a){var b=a.words;a=a.sigBytes;for(var d=[],c=0;c<a;c++)d.push(String.fromCharCode(b[c>>>2]>>>24-c%4*8&255));return d.join("")},parse:function(a){for(var b=a.length,d=[],c=0;c<b;c++)d[c>>>2]|=(a.charCodeAt(c)&255)<<24-c%4*8;return new f.init(d,b)}},x=e.Utf8={stringify:function(a){try{return decodeURIComponent(escape(m.stringify(a)))}catch(b){throw Error("Malformed UTF-8 data");
}},parse:function(a){return m.parse(unescape(encodeURIComponent(a)))}},k=b.BufferedBlockAlgorithm=c.extend({reset:function(){this._data=new f.init;this._nDataBytes=0},_append:function(a){"string"==typeof a&&(a=x.parse(a));this._data.concat(a);this._nDataBytes+=a.sigBytes},_process:function(a){var b=this._data,d=b.words,c=b.sigBytes,e=this.blockSize,m=c/(4*e),m=a?g.ceil(m):g.max((m|0)-this._minBufferSize,0);a=m*e;c=g.min(4*a,c);if(a){for(var k=0;k<a;k+=e)this._doProcessBlock(d,k);k=d.splice(0,a);b.sigBytes-=
c}return new f.init(k,c)},clone:function(){var a=c.clone.call(this);a._data=this._data.clone();return a},_minBufferSize:0});b.Hasher=k.extend({cfg:c.extend(),init:function(a){this.cfg=this.cfg.extend(a);this.reset()},reset:function(){k.reset.call(this);this._doReset()},update:function(a){this._append(a);this._process();return this},finalize:function(a){a&&this._append(a);return this._doFinalize()},blockSize:16,_createHelper:function(a){return function(b,d){return(new a.init(d)).finalize(b)}},_createHmacHelper:function(a){return function(b,
d){return(new w.HMAC.init(a,d)).finalize(b)}}});var w=a.algo={};return a}(Math);(function(){var g=CryptoJS,h=g.lib.WordArray;g.enc.Base64={stringify:function(a){var b=a.words,c=a.sigBytes,f=this._map;a.clamp();a=[];for(var e=0;e<c;e+=3)for(var d=(b[e>>>2]>>>24-e%4*8&255)<<16|(b[e+1>>>2]>>>24-(e+1)%4*8&255)<<8|b[e+2>>>2]>>>24-(e+2)%4*8&255,m=0;4>m&&e+.75*m<c;m++)a.push(f.charAt(d>>>6*(3-m)&63));if(b=f.charAt(64))for(;a.length%4;)a.push(b);return a.join("")},parse:function(a){var b=a.length,c=this._map,f=c.charAt(64);f&&(f=a.indexOf(f),-1!=f&&(b=f));for(var f=[],e=0,d=0;d<b;d++)if(d%
4){var m=c.indexOf(a.charAt(d-1))<<d%4*2,g=c.indexOf(a.charAt(d))>>>6-d%4*2;f[e>>>2]|=(m|g)<<24-e%4*8;e++}return h.create(f,e)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}})();(function(){var g=CryptoJS,h=g.enc.Utf8;g.algo.HMAC=g.lib.Base.extend({init:function(a,b){a=this._hasher=new a.init;"string"==typeof b&&(b=h.parse(b));var c=a.blockSize,f=4*c;b.sigBytes>f&&(b=a.finalize(b));b.clamp();for(var e=this._oKey=b.clone(),d=this._iKey=b.clone(),m=e.words,g=d.words,k=0;k<c;k++)m[k]^=1549556828,g[k]^=909522486;e.sigBytes=d.sigBytes=f;this.reset()},reset:function(){var a=this._hasher;a.reset();a.update(this._iKey)},update:function(a){this._hasher.update(a);return this},finalize:function(a){var b=
this._hasher;a=b.finalize(a);b.reset();return b.finalize(this._oKey.clone().concat(a))}})})();(function(g){var h=CryptoJS,a=h.lib,b=a.WordArray,c=a.Hasher,a=h.algo,f=[],e=[];(function(){function a(b){for(var d=g.sqrt(b),c=2;c<=d;c++)if(!(b%c))return!1;return!0}function b(a){return 4294967296*(a-(a|0))|0}for(var d=2,c=0;64>c;)a(d)&&(8>c&&(f[c]=b(g.pow(d,.5))),e[c]=b(g.pow(d,1/3)),c++),d++})();var d=[],a=a.SHA256=c.extend({_doReset:function(){this._hash=new b.init(f.slice(0))},_doProcessBlock:function(a,b){for(var c=this._hash.words,f=c[0],g=c[1],h=c[2],l=c[3],n=c[4],t=c[5],A=c[6],z=c[7],p=
0;64>p;p++){if(16>p)d[p]=a[b+p]|0;else{var v=d[p-15],s=d[p-2];d[p]=((v<<25|v>>>7)^(v<<14|v>>>18)^v>>>3)+d[p-7]+((s<<15|s>>>17)^(s<<13|s>>>19)^s>>>10)+d[p-16]}v=z+((n<<26|n>>>6)^(n<<21|n>>>11)^(n<<7|n>>>25))+(n&t^~n&A)+e[p]+d[p];s=((f<<30|f>>>2)^(f<<19|f>>>13)^(f<<10|f>>>22))+(f&g^f&h^g&h);z=A;A=t;t=n;n=l+v|0;l=h;h=g;g=f;f=v+s|0}c[0]=c[0]+f|0;c[1]=c[1]+g|0;c[2]=c[2]+h|0;c[3]=c[3]+l|0;c[4]=c[4]+n|0;c[5]=c[5]+t|0;c[6]=c[6]+A|0;c[7]=c[7]+z|0},_doFinalize:function(){var a=this._data,b=a.words,c=8*this._nDataBytes,
d=8*a.sigBytes;b[d>>>5]|=128<<24-d%32;b[(d+64>>>9<<4)+14]=g.floor(c/4294967296);b[(d+64>>>9<<4)+15]=c;a.sigBytes=4*b.length;this._process();return this._hash},clone:function(){var a=c.clone.call(this);a._hash=this._hash.clone();return a}});h.SHA256=c._createHelper(a);h.HmacSHA256=c._createHmacHelper(a)})(Math);(function(){var g=CryptoJS,h=g.lib,a=h.Base,b=h.WordArray,h=g.algo,c=h.HMAC,f=h.PBKDF2=a.extend({cfg:a.extend({keySize:4,hasher:h.SHA1,iterations:1}),init:function(a){this.cfg=this.cfg.extend(a)},compute:function(a,d){for(var f=this.cfg,g=c.create(f.hasher,a),k=b.create(),h=b.create([1]),u=k.words,q=h.words,l=f.keySize,f=f.iterations;u.length<l;){var n=g.update(d).finalize(h);g.reset();for(var t=n.words,A=t.length,z=n,p=1;p<f;p++){z=g.finalize(z);g.reset();for(var v=z.words,s=0;s<A;s++)t[s]^=v[s]}k.concat(n);
q[0]++}k.sigBytes=4*l;return k}});g.PBKDF2=function(a,b,c){return f.create(c).compute(a,b)}})();/*
 MIT License (c) 2011-2013 Copyright Tavendo GmbH. */
var AUTOBAHNJS_VERSION="0.8.2",global=this;
(function(g,h){"function"===typeof define&&define.amd?define(["when"],function(a){g.ab=h(g,a);return g.ab}):"undefined"!==typeof exports?"undefined"!=typeof module&&module.exports&&(exports=module.exports=h(g,g.when)):g.ab=h(g,g.when)})(global,function(g,h){var a={_version:AUTOBAHNJS_VERSION};(function(){Array.prototype.indexOf||(Array.prototype.indexOf=function(a){if(null===this)throw new TypeError;var c=Object(this),f=c.length>>>0;if(0===f)return-1;var e=0;0<arguments.length&&(e=Number(arguments[1]),
e!==e?e=0:0!==e&&Infinity!==e&&-Infinity!==e&&(e=(0<e||-1)*Math.floor(Math.abs(e))));if(e>=f)return-1;for(e=0<=e?e:Math.max(f-Math.abs(e),0);e<f;e++)if(e in c&&c[e]===a)return e;return-1});Array.prototype.forEach||(Array.prototype.forEach=function(a,c){var f,e;if(null===this)throw new TypeError(" this is null or not defined");var d=Object(this),g=d.length>>>0;if("[object Function]"!=={}.toString.call(a))throw new TypeError(a+" is not a function");c&&(f=c);for(e=0;e<g;){var h;e in d&&(h=d[e],a.call(f,
h,e,d));e++}})})();a._sliceUserAgent=function(a,c,f){var e=[],d=navigator.userAgent;a=d.indexOf(a);c=d.indexOf(c,a);0>c&&(c=d.length);f=d.slice(a,c).split(f);d=f[1].split(".");for(c=0;c<d.length;++c)e.push(parseInt(d[c],10));return{name:f[0],version:e}};a.getBrowser=function(){var b=navigator.userAgent;return-1<b.indexOf("Chrome")?a._sliceUserAgent("Chrome"," ","/"):-1<b.indexOf("Safari")?a._sliceUserAgent("Safari"," ","/"):-1<b.indexOf("Firefox")?a._sliceUserAgent("Firefox"," ","/"):-1<b.indexOf("MSIE")?
a._sliceUserAgent("MSIE",";"," "):null};a.getServerUrl=function(a,c){return"file:"===g.location.protocol?c?c:"ws://127.0.0.1/ws":("https:"===g.location.protocol?"wss://":"ws://")+g.location.hostname+(""!==g.location.port?":"+g.location.port:"")+"/"+(a?a:"ws")};a.browserNotSupportedMessage="Browser does not support WebSockets (RFC6455)";a.deriveKey=function(a,c){return c&&c.salt?CryptoJS.PBKDF2(a,c.salt,{keySize:(c.keylen||32)/4,iterations:c.iterations||1E4,hasher:CryptoJS.algo.SHA256}).toString(CryptoJS.enc.Base64):
a};a._idchars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";a._idlen=16;a._subprotocol="wamp";a._newid=function(){for(var b="",c=0;c<a._idlen;c+=1)b+=a._idchars.charAt(Math.floor(Math.random()*a._idchars.length));return b};a._newidFast=function(){return Math.random().toString(36)};a.log=function(){if(1<arguments.length){console.group("Log Item");for(var a=0;a<arguments.length;a+=1)console.log(arguments[a]);console.groupEnd()}else console.log(arguments[0])};a._debugrpc=!1;a._debugpubsub=
!1;a._debugws=!1;a._debugconnect=!1;a.debug=function(b,c,f){if("console"in g)a._debugrpc=b,a._debugpubsub=b,a._debugws=c,a._debugconnect=f;else throw"browser does not support console object";};a.version=function(){return a._version};a.PrefixMap=function(){this._index={};this._rindex={}};a.PrefixMap.prototype.get=function(a){return this._index[a]};a.PrefixMap.prototype.set=function(a,c){this._index[a]=c;this._rindex[c]=a};a.PrefixMap.prototype.setDefault=function(a){this._index[""]=a;this._rindex[a]=
""};a.PrefixMap.prototype.remove=function(a){var c=this._index[a];c&&(delete this._index[a],delete this._rindex[c])};a.PrefixMap.prototype.resolve=function(a,c){var f=a.indexOf(":");if(0<=f){var e=a.substring(0,f);if(this._index[e])return this._index[e]+a.substring(f+1)}return!0===c?a:null};a.PrefixMap.prototype.shrink=function(a,c){for(var f=a.length;0<f;f-=1){var e=a.substring(0,f);if(e=this._rindex[e])return e+":"+a.substring(f)}return!0===c?a:null};a._MESSAGE_TYPEID_WELCOME=0;a._MESSAGE_TYPEID_PREFIX=
1;a._MESSAGE_TYPEID_CALL=2;a._MESSAGE_TYPEID_CALL_RESULT=3;a._MESSAGE_TYPEID_CALL_ERROR=4;a._MESSAGE_TYPEID_SUBSCRIBE=5;a._MESSAGE_TYPEID_UNSUBSCRIBE=6;a._MESSAGE_TYPEID_PUBLISH=7;a._MESSAGE_TYPEID_EVENT=8;a.CONNECTION_CLOSED=0;a.CONNECTION_LOST=1;a.CONNECTION_RETRIES_EXCEEDED=2;a.CONNECTION_UNREACHABLE=3;a.CONNECTION_UNSUPPORTED=4;a.CONNECTION_UNREACHABLE_SCHEDULED_RECONNECT=5;a.CONNECTION_LOST_SCHEDULED_RECONNECT=6;a.Deferred=h.defer;a._construct=function(a,c){return"WebSocket"in g?c?new WebSocket(a,
c):new WebSocket(a):"MozWebSocket"in g?c?new MozWebSocket(a,c):new MozWebSocket(a):null};a.Session=function(b,c,f,e){var d=this;d._wsuri=b;d._options=e;d._websocket_onopen=c;d._websocket_onclose=f;d._websocket=null;d._websocket_connected=!1;d._session_id=null;d._wamp_version=null;d._server=null;d._calls={};d._subscriptions={};d._prefixes=new a.PrefixMap;d._txcnt=0;d._rxcnt=0;d._websocket=d._options&&d._options.skipSubprotocolAnnounce?a._construct(d._wsuri):a._construct(d._wsuri,[a._subprotocol]);
if(!d._websocket){if(void 0!==f){f(a.CONNECTION_UNSUPPORTED);return}throw a.browserNotSupportedMessage;}d._websocket.onmessage=function(b){a._debugws&&(d._rxcnt+=1,console.group("WS Receive"),console.info(d._wsuri+"  ["+d._session_id+"]"),console.log(d._rxcnt),console.log(b.data),console.groupEnd());b=JSON.parse(b.data);if(b[1]in d._calls){if(b[0]===a._MESSAGE_TYPEID_CALL_RESULT){var c=d._calls[b[1]],e=b[2];if(a._debugrpc&&void 0!==c._ab_callobj){console.group("WAMP Call",c._ab_callobj[2]);console.timeEnd(c._ab_tid);
console.group("Arguments");for(var f=3;f<c._ab_callobj.length;f+=1){var g=c._ab_callobj[f];if(void 0!==g)console.log(g);else break}console.groupEnd();console.group("Result");console.log(e);console.groupEnd();console.groupEnd()}c.resolve(e)}else if(b[0]===a._MESSAGE_TYPEID_CALL_ERROR){c=d._calls[b[1]];e=b[2];f=b[3];g=b[4];if(a._debugrpc&&void 0!==c._ab_callobj){console.group("WAMP Call",c._ab_callobj[2]);console.timeEnd(c._ab_tid);console.group("Arguments");for(var h=3;h<c._ab_callobj.length;h+=1){var l=
c._ab_callobj[h];if(void 0!==l)console.log(l);else break}console.groupEnd();console.group("Error");console.log(e);console.log(f);void 0!==g&&console.log(g);console.groupEnd();console.groupEnd()}void 0!==g?c.reject({uri:e,desc:f,detail:g}):c.reject({uri:e,desc:f})}delete d._calls[b[1]]}else if(b[0]===a._MESSAGE_TYPEID_EVENT){if(c=d._prefixes.resolve(b[1],!0),c in d._subscriptions){var n=b[1],t=b[2];a._debugpubsub&&(console.group("WAMP Event"),console.info(d._wsuri+"  ["+d._session_id+"]"),console.log(n),
console.log(t),console.groupEnd());d._subscriptions[c].forEach(function(a){a(n,t)})}}else if(b[0]===a._MESSAGE_TYPEID_WELCOME)if(null===d._session_id){d._session_id=b[1];d._wamp_version=b[2];d._server=b[3];if(a._debugrpc||a._debugpubsub)console.group("WAMP Welcome"),console.info(d._wsuri+"  ["+d._session_id+"]"),console.log(d._wamp_version),console.log(d._server),console.groupEnd();null!==d._websocket_onopen&&d._websocket_onopen()}else throw"protocol error (welcome message received more than once)";
};d._websocket.onopen=function(b){if(d._websocket.protocol!==a._subprotocol)if("undefined"===typeof d._websocket.protocol)a._debugws&&(console.group("WS Warning"),console.info(d._wsuri),console.log("WebSocket object has no protocol attribute: WAMP subprotocol check skipped!"),console.groupEnd());else if(d._options&&d._options.skipSubprotocolCheck)a._debugws&&(console.group("WS Warning"),console.info(d._wsuri),console.log("Server does not speak WAMP, but subprotocol check disabled by option!"),console.log(d._websocket.protocol),
console.groupEnd());else throw d._websocket.close(1E3,"server does not speak WAMP"),"server does not speak WAMP (but '"+d._websocket.protocol+"' !)";a._debugws&&(console.group("WAMP Connect"),console.info(d._wsuri),console.log(d._websocket.protocol),console.groupEnd());d._websocket_connected=!0};d._websocket.onerror=function(a){};d._websocket.onclose=function(b){a._debugws&&(d._websocket_connected?console.log("Autobahn connection to "+d._wsuri+" lost (code "+b.code+", reason '"+b.reason+"', wasClean "+
b.wasClean+")."):console.log("Autobahn could not connect to "+d._wsuri+" (code "+b.code+", reason '"+b.reason+"', wasClean "+b.wasClean+")."));void 0!==d._websocket_onclose&&(d._websocket_connected?b.wasClean?d._websocket_onclose(a.CONNECTION_CLOSED,"WS-"+b.code+": "+b.reason):d._websocket_onclose(a.CONNECTION_LOST):d._websocket_onclose(a.CONNECTION_UNREACHABLE));d._websocket_connected=!1;d._wsuri=null;d._websocket_onopen=null;d._websocket_onclose=null;d._websocket=null};d.log=function(){d._options&&
"sessionIdent"in d._options?console.group("WAMP Session '"+d._options.sessionIdent+"' ["+d._session_id+"]"):console.group("WAMP Session ["+d._session_id+"]");for(var a=0;a<arguments.length;++a)console.log(arguments[a]);console.groupEnd()}};a.Session.prototype._send=function(b){if(!this._websocket_connected)throw"Autobahn not connected";switch(!0){case g.Prototype&&"undefined"===typeof top.root.__prototype_deleted:case "function"===typeof b.toJSON:b=b.toJSON();break;default:b=JSON.stringify(b)}this._websocket.send(b);
this._txcnt+=1;a._debugws&&(console.group("WS Send"),console.info(this._wsuri+"  ["+this._session_id+"]"),console.log(this._txcnt),console.log(b),console.groupEnd())};a.Session.prototype.close=function(){this._websocket_connected&&this._websocket.close()};a.Session.prototype.sessionid=function(){return this._session_id};a.Session.prototype.wsuri=function(){return this._wsuri};a.Session.prototype.shrink=function(a,c){void 0===c&&(c=!0);return this._prefixes.shrink(a,c)};a.Session.prototype.resolve=
function(a,c){void 0===c&&(c=!0);return this._prefixes.resolve(a,c)};a.Session.prototype.prefix=function(b,c){this._prefixes.set(b,c);if(a._debugrpc||a._debugpubsub)console.group("WAMP Prefix"),console.info(this._wsuri+"  ["+this._session_id+"]"),console.log(b),console.log(c),console.groupEnd();this._send([a._MESSAGE_TYPEID_PREFIX,b,c])};a.Session.prototype.call=function(){for(var b=new a.Deferred,c;c=a._newidFast(),c in this._calls;);this._calls[c]=b;for(var f=this._prefixes.shrink(arguments[0],
!0),f=[a._MESSAGE_TYPEID_CALL,c,f],e=1;e<arguments.length;e+=1)f.push(arguments[e]);this._send(f);a._debugrpc&&(b._ab_callobj=f,b._ab_tid=this._wsuri+"  ["+this._session_id+"]["+c+"]",console.time(b._ab_tid),console.info());return b.promise.then?b.promise:b};a.Session.prototype.subscribe=function(b,c){var f=this._prefixes.resolve(b,!0);f in this._subscriptions||(a._debugpubsub&&(console.group("WAMP Subscribe"),console.info(this._wsuri+"  ["+this._session_id+"]"),console.log(b),console.log(c),console.groupEnd()),
this._send([a._MESSAGE_TYPEID_SUBSCRIBE,b]),this._subscriptions[f]=[]);if(-1===this._subscriptions[f].indexOf(c))this._subscriptions[f].push(c);else throw"callback "+c+" already subscribed for topic "+f;};a.Session.prototype.unsubscribe=function(b,c){var f=this._prefixes.resolve(b,!0);if(f in this._subscriptions){var e;if(void 0!==c){var d=this._subscriptions[f].indexOf(c);if(-1!==d)e=c,this._subscriptions[f].splice(d,1);else throw"no callback "+c+" subscribed on topic "+f;}else e=this._subscriptions[f].slice(),
this._subscriptions[f]=[];0===this._subscriptions[f].length&&(delete this._subscriptions[f],a._debugpubsub&&(console.group("WAMP Unsubscribe"),console.info(this._wsuri+"  ["+this._session_id+"]"),console.log(b),console.log(e),console.groupEnd()),this._send([a._MESSAGE_TYPEID_UNSUBSCRIBE,b]))}else throw"not subscribed to topic "+f;};a.Session.prototype.publish=function(){var b=arguments[0],c=arguments[1],f=null,e=null,d=null,g=null;if(3<arguments.length){if(!(arguments[2]instanceof Array))throw"invalid argument type(s)";
if(!(arguments[3]instanceof Array))throw"invalid argument type(s)";e=arguments[2];d=arguments[3];g=[a._MESSAGE_TYPEID_PUBLISH,b,c,e,d]}else if(2<arguments.length)if("boolean"===typeof arguments[2])f=arguments[2],g=[a._MESSAGE_TYPEID_PUBLISH,b,c,f];else if(arguments[2]instanceof Array)e=arguments[2],g=[a._MESSAGE_TYPEID_PUBLISH,b,c,e];else throw"invalid argument type(s)";else g=[a._MESSAGE_TYPEID_PUBLISH,b,c];a._debugpubsub&&(console.group("WAMP Publish"),console.info(this._wsuri+"  ["+this._session_id+
"]"),console.log(b),console.log(c),null!==f?console.log(f):null!==e&&(console.log(e),null!==d&&console.log(d)),console.groupEnd());this._send(g)};a.Session.prototype.authreq=function(a,c){return this.call("http://api.wamp.ws/procedure#authreq",a,c)};a.Session.prototype.authsign=function(a,c){c||(c="");return CryptoJS.HmacSHA256(a,c).toString(CryptoJS.enc.Base64)};a.Session.prototype.auth=function(a){return this.call("http://api.wamp.ws/procedure#auth",a)};a._connect=function(b){var c=new a.Session(b.wsuri,
function(){b.connects+=1;b.retryCount=0;b.onConnect(c)},function(c,e){var d=null;switch(c){case a.CONNECTION_CLOSED:b.onHangup(c,"Connection was closed properly ["+e+"]");break;case a.CONNECTION_UNSUPPORTED:b.onHangup(c,"Browser does not support WebSocket.");break;case a.CONNECTION_UNREACHABLE:b.retryCount+=1;if(0===b.connects)b.onHangup(c,"Connection could not be established.");else if(b.retryCount<=b.options.maxRetries)(d=b.onHangup(a.CONNECTION_UNREACHABLE_SCHEDULED_RECONNECT,"Connection unreachable - scheduled reconnect to occur in "+
b.options.retryDelay/1E3+" second(s) - attempt "+b.retryCount+" of "+b.options.maxRetries+".",{delay:b.options.retryDelay,retries:b.retryCount,maxretries:b.options.maxRetries}))?(a._debugconnect&&console.log("Connection unreachable - retrying stopped by app"),b.onHangup(a.CONNECTION_RETRIES_EXCEEDED,"Number of connection retries exceeded.")):(a._debugconnect&&console.log("Connection unreachable - retrying ("+b.retryCount+") .."),g.setTimeout(function(){a._connect(b)},b.options.retryDelay));else b.onHangup(a.CONNECTION_RETRIES_EXCEEDED,
"Number of connection retries exceeded.");break;case a.CONNECTION_LOST:b.retryCount+=1;if(b.retryCount<=b.options.maxRetries)(d=b.onHangup(a.CONNECTION_LOST_SCHEDULED_RECONNECT,"Connection lost - scheduled "+b.retryCount+"th reconnect to occur in "+b.options.retryDelay/1E3+" second(s).",{delay:b.options.retryDelay,retries:b.retryCount,maxretries:b.options.maxRetries}))?(a._debugconnect&&console.log("Connection lost - retrying stopped by app"),b.onHangup(a.CONNECTION_RETRIES_EXCEEDED,"Connection lost.")):
(a._debugconnect&&console.log("Connection lost - retrying ("+b.retryCount+") .."),g.setTimeout(function(){a._connect(b)},b.options.retryDelay));else b.onHangup(a.CONNECTION_RETRIES_EXCEEDED,"Connection lost.");break;default:throw"unhandled close code in ab._connect";}},b.options)};a.connect=function(b,c,f,e){var d={};d.wsuri=b;d.options=e?e:{};void 0===d.options.retryDelay&&(d.options.retryDelay=5E3);void 0===d.options.maxRetries&&(d.options.maxRetries=10);void 0===d.options.skipSubprotocolCheck&&
(d.options.skipSubprotocolCheck=!1);void 0===d.options.skipSubprotocolAnnounce&&(d.options.skipSubprotocolAnnounce=!1);if(c)d.onConnect=c;else throw"onConnect handler required!";d.onHangup=f?f:function(b,c,d){a._debugconnect&&console.log(b,c,d)};d.connects=0;d.retryCount=0;a._connect(d)};a.launch=function(b,c,f){a.connect(b.wsuri,function(e){b.appkey&&""!==b.appkey?e.authreq(b.appkey,b.appextra).then(function(d){var f=null;"function"===typeof b.appsecret?f=b.appsecret(d):(f=a.deriveKey(b.appsecret,
JSON.parse(d).authextra),f=e.authsign(d,f));e.auth(f).then(function(b){c?c(e):a._debugconnect&&e.log("Session opened.")},e.log)},e.log):e.authreq().then(function(){e.auth().then(function(b){c?c(e):a._debugconnect&&e.log("Session opened.")},e.log)},e.log)},function(b,c,g){f?f(b,c,g):a._debugconnect&&a.log("Session closed.",b,c,g)},b.sessionConfig)};a._UA_FIREFOX=/.*Firefox\/([0-9+]*).*/;a._UA_CHROME=/.*Chrome\/([0-9+]*).*/;a._UA_CHROMEFRAME=/.*chromeframe\/([0-9]*).*/;a._UA_WEBKIT=/.*AppleWebKit\/([0-9+.]*)w*.*/;
a._UA_WEBOS=/.*webOS\/([0-9+.]*)w*.*/;a._matchRegex=function(a,c){var f=c.exec(a);return f?f[1]:f};a.lookupWsSupport=function(){var b=navigator.userAgent;if(-1<b.indexOf("MSIE")){if(-1<b.indexOf("MSIE 10"))return[!0,!0,!0];if(-1<b.indexOf("chromeframe")){var c=parseInt(a._matchRegex(b,a._UA_CHROMEFRAME));return 14<=c?[!0,!1,!0]:[!1,!1,!1]}if(-1<b.indexOf("MSIE 8")||-1<b.indexOf("MSIE 9"))return[!0,!0,!0]}else{if(-1<b.indexOf("Firefox")){if(c=parseInt(a._matchRegex(b,a._UA_FIREFOX))){if(7<=c)return[!0,
!1,!0];if(3<=c)return[!0,!0,!0]}return[!1,!1,!0]}if(-1<b.indexOf("Safari")&&-1==b.indexOf("Chrome")){if(c=a._matchRegex(b,a._UA_WEBKIT))return-1<b.indexOf("Windows")&&"534+"==c||-1<b.indexOf("Macintosh")&&(c=c.replace("+","").split("."),535==parseInt(c[0])&&24<=parseInt(c[1])||535<parseInt(c[0]))?[!0,!1,!0]:-1<b.indexOf("webOS")?(c=a._matchRegex(b,a._UA_WEBOS).split("."),2==parseInt(c[0])?[!1,!0,!0]:[!1,!1,!1]):[!0,!0,!0]}else if(-1<b.indexOf("Chrome")){if(c=parseInt(a._matchRegex(b,a._UA_CHROME)))return 14<=
c?[!0,!1,!0]:4<=c?[!0,!0,!0]:[!1,!1,!0]}else if(-1<b.indexOf("Android")){if(-1<b.indexOf("Firefox")||-1<b.indexOf("CrMo"))return[!0,!1,!0];if(-1<b.indexOf("Opera"))return[!1,!1,!0];if(-1<b.indexOf("CrMo"))return[!0,!0,!0]}else if(-1<b.indexOf("iPhone")||-1<b.indexOf("iPad")||-1<b.indexOf("iPod"))return[!1,!1,!0]}return[!1,!1,!1]};return a});
